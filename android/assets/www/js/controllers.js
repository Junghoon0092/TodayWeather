angular.module("starter.controllers",[]).run(["WeatherInfo",function(t){t.loadTowns(),t.loadCities(),t.updateCities()}]).controller("ForecastCtrl",["$scope","$rootScope","$ionicPlatform","$ionicAnalytics","$ionicScrollDelegate","$ionicNavBarDelegate","$q","$http","$timeout","WeatherInfo","WeatherUtil","Util","$stateParams","$location","$ionicHistory","$sce",function(t,e,o,n,i,r,a,s,c,d,l,u,f,h,g,p){function y(){var e="";return ionic.Platform.isIOS()&&(e+='<div style="height: 20px"></div>'),e+='<p class="textFont" style="font-size:'+W+'px; margin: 0">',T.currentPosition&&(e+='<a class="icon ion-ios-location-outline" style="color: white;"></a>'),e+=I+"</p>",e+='<div class="row row-no-padding"> <div style="margin: auto"> <div class="row row-no-padding">',e+='<p style="font-size: '+B+'px; margin: 0">'+T.currentWeather.t1h+"</p>",e+='<div style="text-align: left; margin: auto">',e+='<img style="height: '+k+'px" src="img/reddot.png">',e+="<br>",e+='<img style="height: '+P+'px" src="'+u.imgPath+"/"+T.currentWeather.skyIcon+'.png">',e+="</div>",e+="</div></div></div>",e+='<p class="textFont" style="font-size: '+A+'px; margin: 0;">'+t.currentWeather.summary+"</p>"}function m(){var e,o,n="";for(n+='<div class="row row-no-padding"> <div style="width: '+S/2+'px;"></div>',e=0;e<T.dayTable.length;e++)o=T.dayTable[e],o.date>T.timeTable[0].date&&o.date<=T.timeTable[T.timeTable.length-1].date&&(n+='<div class="col">',n+='<p style="font-size: '+H+'px; margin: 0; opacity: 0.84">',n+=t.getDayText(o),n+=' <span style="font-size: 13px; opacity: 0.54">',n+=t.getDayForecast(o),n+="</span></p></div>");for(n+='<div style="width: '+S/2+'px;"></div> </div>',n+='<hr style="margin: 0; border: 0; border-top:1px solid rgba(255,255,255,0.6);">',n+='<div class="row row-no-padding" style="flex: 1; text-align: center">',e=0;e<T.timeTable.length;e++)o=T.timeTable[e],n+='<div class="col table-items">',n+='<p style="font-size: '+H+'px; margin:auto">'+o.timeStr+"</p>",n+="<img width="+D+'px style="margin: auto" src="img/'+o.tempIcon+'.png">',n+='<p style="font-size: '+L+'px; margin: auto">'+o.t3h+"˚</p>",n+="<img width="+D+'px style="margin: auto" src="'+u.imgPath+"/"+o.skyIcon+'.png">',void 0!=o.rn1&&(o.date<T.currentWeather.date||o.time<=T.currentWeather.time)?(n+='<p style="font-size: '+L+'px; margin: auto">'+o.rn1,n+='<span style="font-size:10px">',n+=3===o.pty?"cm":"mm",n+="</span></p>"):n+='<p style="font-size: '+L+'px; margin: auto">'+o.pop+"<small>%</small></p>",n+="</div>";return n+="</div>"}function v(){var t,e,o="",n="-";for(o+='<hr style="margin: 0; border: 0; border-top:1px solid rgba(255,255,255,0.6);">',o+='<div class="row row-no-padding" style="flex: 1; text-align: center">',t=0;t<T.dayTable.length;t++)e=T.dayTable[t],o+='<div class="col table-items">',o+='<p style="margin: auto; font-size: '+H+"px;",0===e.fromToday?(o+=" border-bottom: 1px solid rgba(255,255,255,0.8);",o+=' opacity: 1;">'):o+=' opacity: 0.84;">',o+=e.week+"</p>",o+='<img style="width: '+D+'px; margin: auto;" src="'+u.imgPath+"/"+e.skyIcon+'.png">',void 0!=e.rn1?(o+='<p style="font-size: '+L+'px; margin: auto">'+e.rn1,o+='<span style="font-size:10px">',o+=3===e.pty?"cm":"mm",o+="</span></p>"):(n=void 0==e.pop?"-":e.pop+"<small>%</small>",o+='<p style="font-size: '+L+'px; margin: auto">'+n+"</p>"),o+='<img style="width: '+D+'px; margin: auto" src="img/'+e.humidityIcon+'.png">',n=void 0==e.reh?"-":e.reh+"<small>%</small>",o+='<p style="font-size: '+L+'px; margin: auto">'+n+"</p>",o+="</div>";return o+="</div>"}function w(){T=d.getCityOfIndex(d.cityIndex),null!==T&&(t.timeWidth=b()*T.timeTable.length,t.dayWidth=b()*T.dayTable.length,I=l.getShortenAddress(T.address),t.currentWeather=T.currentWeather,t.timeChart=T.timeChart,t.dayChart=T.dayChart,t.currentPosition=T.currentPosition,setTimeout(function(){t.topMainBox=p.trustAsHtml(y()),t.shortTable=p.trustAsHtml(m()),t.midTable=p.trustAsHtml(v()),"short"===t.forecastType?i.$getByHandle("timeChart").scrollTo(C(),0,!1):"mid"===t.forecastType&&i.$getByHandle("weeklyChart").scrollTo(C(),0,!1)},100),u.ga.trackEvent("weather","load",I,d.cityIndex))}function x(e){var o=a.defer();if(null===T)return o.resolve(),o.promise;var n=!1,i=!1;return null===T.location&&e===!1?(o.resolve(),o.promise):(T.currentPosition===!1&&(i=!0),l.getWeatherInfo(T.address,d.towns).then(function(t){if(1!==o.promise.$$state.status&&2!==o.promise.$$state.status){n=!0;var e=l.convertWeatherData(t);d.updateCity(d.cityIndex,e),w(),o.notify(),i===!0&&o.resolve()}},function(){if(1!==o.promise.$$state.status&&2!==o.promise.$$state.status&&i===!0)if(T.currentPosition===!1){var e="위치 정보 업데이트를 실패하였습니다.";t.showAlert("에러",e),o.reject()}else o.resolve()}),T.currentPosition===!0&&l.getCurrentPosition().then(function(e){l.getAddressFromGeolocation(e.latitude,e.longitude).then(function(r){T.address===r?(i=!0,n===!0&&o.resolve()):l.getWeatherInfo(r,d.towns).then(function(t){var n=l.convertWeatherData(t);n.address=r,n.location={lat:e.latitude,"long":e.longitude},d.updateCity(d.cityIndex,n),w(),o.notify(),o.resolve()},function(){var e="현재 위치 정보 업데이트를 실패하였습니다.";t.showAlert("에러",e),o.reject()})},function(){var e="현재 위치에 대한 정보를 찾을 수 없습니다.";t.showAlert("에러",e),o.reject()})},function(){var e="현재 위치를 찾을 수 없습니다.";ionic.Platform.isAndroid()&&(e+="<br>WIFI와 위치정보를 켜주세요."),t.showAlert("에러",e),o.reject()}),o.promise)}function b(){return S?S:(S=$/7,S>60&&(S=60),S)}function C(){var e=new Date,o=0;if("short"===t.forecastType){var n=e.getHours();return o=7,$>=720?b()*o:(n>=3&&(o+=1),n>=6&&(o+=1),n>=9&&(o+=1),b()*o)}if("mid"===t.forecastType){if($>=720)return 0;var i=e.getDay(),r=1;return 1===i?o=5:(0===i&&(i=7,r+=1),o=6+r-i),b()*o}return b()*o}var S,T,$=window.innerWidth;t.forecastType="short";var I="";t.currentWeather,t.timeChart,t.dayChart,t.timeWidth,t.dayWidth;var W,A,B,k,P,H,D,L;!function(){u.ga.trackEvent("page","tab","forecast"),g.clearHistory();var t=1,e=1;460!==window.innerHeight&&480!==window.innerHeight||320!==window.innerWidth||(t=1.125,e=1.1),548!==window.innerHeight&&568!==window.innerHeight||320!==window.innerWidth||(e=1.1);var o=window.innerHeight-100;W=.0408*o*t,W=33.04>W?W:33.04,A=.0376*o*t,A=30.45>A?A:30.45,B=.17544*o*t,B=142.1>B?B:142.1,k=.03384*o*t,k=27.4>k?k:27.4,P=.11264*o*t,P=91.2>P?P:91.2,H=.0299*o*e,H=19.37>H?H:19.37,D=.0512*o*e,D=33.17>D?D:33.17,L=.032*o*e,L=20.73>L?L:20.73}(),t.changeForecastType=function(){"short"===t.forecastType?(t.forecastType="mid",e.viewColor="#8BC34A",window.StatusBar&&StatusBar.backgroundColorByHexString("#689F38"),setTimeout(function(){i.$getByHandle("weeklyChart").scrollTo(C(),0,!1)},0)):"mid"===t.forecastType?(t.forecastType="detail",e.viewColor="#00BCD4",window.StatusBar&&StatusBar.backgroundColorByHexString("#0097A7")):"detail"===t.forecastType&&(t.forecastType="short",e.viewColor="#03A9F4",window.StatusBar&&StatusBar.backgroundColorByHexString("#0288D1"),setTimeout(function(){i.$getByHandle("timeChart").scrollTo(C(),0,!1)},0))},t.doRefresh=function(){t.isLoading=!0,x(!0).finally(function(){I=l.getShortenAddress(T.address),t.isLoading=!1})},t.onSwipeLeft=function(){1!==d.getCityCount()&&(d.setCityIndex(d.cityIndex===d.getCityCount()-1?0:d.cityIndex+1),w())},t.onSwipeRight=function(){1!==d.getCityCount()&&(d.setCityIndex(0===d.cityIndex?d.getCityCount()-1:d.cityIndex-1),w())},t.getDayText=function(t){return t.fromTodayStr+" "+t.date.substr(4,2)+"."+t.date.substr(6,2)},t.getDayForecast=function(t){var e=[];return 0===t.fromToday||1===t.fromToday?(t.dustForecast&&t.dustForecast.PM10Str&&e.push("미세예보:"+t.dustForecast.PM10Str),t.ultrvStr&&e.push("자외선:"+t.ultrvStr),e.toString()):e.toString()},t.$on("$ionicView.loaded",function(){e.viewColor="#22a1db",window.StatusBar&&StatusBar.backgroundColorByHexString("#0288D1")}),t.$on("updateWeatherEvent",function(){t.doRefresh()}),o.ready(function(){e.viewColor="#22a1db",window.StatusBar&&StatusBar.backgroundColorByHexString("#0288D1"),void 0!==f.fav&&f.fav<d.getCityCount()&&d.setCityIndex(f.fav),w()})}]).controller("SearchCtrl",["$scope","$rootScope","$ionicPlatform","$ionicAnalytics","$ionicScrollDelegate","$location","WeatherInfo","WeatherUtil","Util","ionicTimePicker","Push",function(t,e,o,n,i,r,a,s,c,d,l){function u(){c.ga.trackEvent("page","tab","search"),a.cities.forEach(function(e,o){var n=s.getShortenAddress(e.address).split(","),i=e.dayTable.filter(function(t){return 0===t.fromToday});e.currentWeather||(e.currentWeather={}),e.currentWeather.skyIcon||(e.currentWeather.skyIcon="Sun"),void 0===e.currentWeather.t1h&&(e.currentWeather.t1h="-"),i&&0!==i.length||i.push({tmn:"-",tmx:"-"});var r={address:n,currentPosition:e.currentPosition,skyIcon:e.currentWeather.skyIcon,t1h:e.currentWeather.t1h,tmn:i[0].tmn,tmx:i[0].tmx,"delete":!1};t.cityList.push(r),t.cityList[o].alarmInfo=l.getAlarm(o)})}t.searchWord=void 0,t.searchResults=[],t.cityList=[],t.isLoading=!1,t.imgPath=c.imgPath;var f=a.towns,h=-1;t.OnChangeSearchWord=function(){return""===t.searchWord?(t.searchWord=void 0,void(t.searchResults=[])):(t.searchResults=[],i.$getByHandle("cityList").scrollTop(),h=0,void t.OnScrollResults())},t.OnScrollResults=function(){if(void 0!==t.searchWord&&-1!==h){for(var e=h;e<f.length;e++){var o=f[e];if((o.first.indexOf(t.searchWord)>=0||o.second.indexOf(t.searchWord)>=0||o.third.indexOf(t.searchWord)>=0)&&(t.searchResults.push(o),t.searchResults.length%10===0))return void(h=e+1)}h=-1}},t.OnSelectResult=function(e){if(window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.isVisible)return cordova.plugins.Keyboard.close();t.searchWord=void 0,t.searchResults=[],t.isLoading=!0;var o="대한민국 "+e.first;if(""!==e.second)if("도"===e.first.slice(-1)&&"구"===e.second.slice(-1))if(e.second.indexOf(" ")>0){var n=e.second.split(" ");o=" "+n[0],o=" "+n[1]}else o+=" "+e.second.substr(0,e.second.indexOf("시")+1),o+=" "+e.second.substr(e.second.indexOf("시")+1,e.second.length);else o+=" "+e.second;""!==e.third&&(o+=" "+e.third),s.getWeatherInfo(o,a.towns).then(function(e){var n=s.convertWeatherData(e);if(n.currentPosition=!1,n.address=o,n.location=location,a.addCity(n)===!1){var i="이미 동일한 지역이 추가되어 있습니다.";t.showAlert("에러",i)}else a.setCityIndex(a.getCityCount()-1),r.path("/tab/forecast");t.isLoading=!1},function(){var e="현재 위치 정보 업데이트를 실패하였습니다.";t.showAlert("에러",e),t.isLoading=!1})},t.OnSwipeCity=function(t){t.currentPosition===!1&&(t.delete=!t.delete)},t.OnSelectCity=function(t){return window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.isVisible?cordova.plugins.Keyboard.close():(a.setCityIndex(t),void r.path("/tab/forecast"))},t.OnDeleteCity=function(e){return void 0!=t.cityList[e].alarmInfo&&l.removeAlarm(t.cityList[e].alarmInfo),t.cityList.splice(e,1),a.removeCity(e),a.cityIndex===a.getCityCount()&&a.setCityIndex(0),!1},t.openTimePicker=function(e){var o={callback:function(o){if("undefined"==typeof o);else if(0==o)void 0!=t.cityList[e].alarmInfo&&(l.removeAlarm(t.cityList[e].alarmInfo),t.cityList[e].alarmInfo=void 0);else{var n=new Date;n.setHours(0,0,0,0),n.setSeconds(o),l.updateAlarm(e,a.cities[e].address,n,function(o,n){t.cityList[e].alarmInfo=n})}}};if(void 0!=t.cityList[e].alarmInfo){var n=new Date(t.cityList[e].alarmInfo.time);o.inputTime=60*n.getHours()*60+60*n.getMinutes()}else o.inputTime=28800;d.openTimePicker(o)},t.$on("$ionicView.loaded",function(){e.viewColor="#ec72a8",window.StatusBar&&StatusBar.backgroundColorByHexString("#EC407A")}),o.ready(function(){}),u()}]).controller("SettingCtrl",["$scope","$rootScope","$ionicPlatform","$ionicAnalytics","$http","$cordovaInAppBrowser","Util",function(t,e,o,n,i,r,a){function s(){a.ga.trackEvent("page","tab","setting"),window.chrome&&chrome.extension&&i({method:"GET",url:chrome.extension.getURL("manifest.json"),timeout:3e3}).success(function(e){t.version=e.version}).error(function(t){})}t.version="0.8.2",t.openMarket=function(){var t="";t=ionic.Platform.isIOS()?"https://itunes.apple.com/us/app/todayweather/id1041700694":ionic.Platform.isAndroid()?"https://play.google.com/store/apps/details?id=net.wizardfactory.todayweather":"https://www.facebook.com/TodayWeather.WF";var e={location:"yes",clearcache:"yes",toolbar:"no"};r.open(t,"_blank",e).then(function(t){}).catch(function(t){})},t.openInfo=function(){var e="기상정보 : 기상청 <br> 대기오염정보 : 환경부/한국환경공단 <br> 인증되지 않은 실시간 자료이므로 자료 오류가 있을 수 있습니다.";t.showAlert("TodayWeather",e)},t.$on("$ionicView.loaded",function(){e.viewColor="#FFA726",window.StatusBar&&StatusBar.backgroundColorByHexString("#FB8C00")}),o.ready(function(){}),s()}]).controller("TabCtrl",["$scope","$ionicPlatform","$ionicPopup","$interval","WeatherInfo","WeatherUtil","$location","$cordovaSocialSharing","TwAds","$rootScope","Util",function(t,e,o,n,i,r,a,s,c,d,l){function u(){f=new Date,t.currentTimeString=r.convertTimeString(f),n(function(){var e=new Date;e.getMinutes()!=f.getMinutes()&&(f=e,t.currentTimeString=r.convertTimeString(f))},1e3)}var f;t.doTabForecast=function(){"/tab/forecast"===a.path()?(t.$broadcast("updateWeatherEvent"),l.ga.trackEvent("page","tab","reload")):a.path("/tab/forecast")},t.doTabShare=function(){var t="";if("/tab/forecast"===a.path()){var e=i.getCityOfIndex(i.cityIndex);null!==e&&null!==e.location&&(t+=r.getShortenAddress(e.address)+"\n",t+="현재 "+e.currentWeather.t1h+"˚ ",t+=r.getWeatherEmoji(e.currentWeather.skyIcon)+"\n",e.dayTable.forEach(function(e){0===e.fromToday&&(t+="최고 "+e.tmx+"˚, 최저 "+e.tmn+"˚\n")}),t+=e.currentWeather.summary+"\n\n")}s.share(t+"오늘날씨 다운로드 >\nhttp://onelink.to/dqud4w",null,null,null).then(function(){},function(){}),l.ga.trackEvent("page","tab","share")},t.showAlert=function(t,e){var n=o.alert({title:t,template:e});n.then(function(){})},t.showConfirm=function(t,e,n){var i=o.confirm({title:t,template:e});i.then(function(t){n(t)})},e.ready(function(){d.viewAdsBanner=c.enableAds,d.contentBottom=c.enableAds?100:50,angular.element(document.getElementsByClassName("tabs")).css("margin-bottom",c.showAds?"50px":"0px"),setTimeout(function(){t.$broadcast("updateWeatherEvent")},200)}),u()}]).controller("GuideCtrl",["$scope","$rootScope","$ionicSlideBoxDelegate","$ionicNavBarDelegate","$location","$ionicHistory","Util","TwAds",function(t,e,o,n,i,r,a,s){function c(){s.setShowAds(!1),a.ga.trackEvent("page","tab","guide"),t.bigFont=.0512*(window.innerHeight-56),t.smallFont=.0299*(window.innerHeight-56),l()}function d(){if(s.setShowAds(!0),"undefined"!=typeof Storage){var t=localStorage.getItem("guideVersion");if(null!==t&&a.guideVersion==Number(t))return void i.path("/tab/setting");localStorage.setItem("guideVersion",a.guideVersion.toString())}i.path("/tab/forecast")}function l(){o.currentIndex()==o.slidesCount()-1?(t.leftText="<",t.rightText="CLOSE"):(t.leftText="SKIP",t.rightText=">")}t.onSlideChanged=function(){l()},t.onLeftClick=function(){o.currentIndex()==o.slidesCount()-1?o.previous():d()},t.onRightClick=function(){o.currentIndex()==o.slidesCount()-1?d():o.next()},t.$on("$ionicView.leave",function(){s.setShowAds(!0)}),t.$on("$ionicView.enter",function(){s.setShowAds(!1),window.StatusBar&&StatusBar.backgroundColorByHexString("#0288D1"),o.slide(0)}),c()}]);